import jsPDF from "jspdf";
import logo from "../../assets/logos/image.png";

const ReportPDFGenerator = ({ data }) => {
  const generatePDF = async () => {
    const doc = new jsPDF("p", "mm", "a4");

    // -------------------------
    // CENTERED LARGE LOGO
    // -------------------------
    const pageWidth = doc.internal.pageSize.getWidth();
    const logoWidth = 120;
    const logoHeight = 40;
    const logoX = (pageWidth - logoWidth) / 2;

    doc.addImage(logo, "PNG", logoX, 15, logoWidth, logoHeight);

    // Title under logo
    doc.setFontSize(14);
    doc.text(
      "Image Forensic Analysis Report",
      pageWidth / 2,
      65,
      { align: "center" }
    );

    doc.line(20, 75, 190, 75);

    // -------------------------
    // Scan Result
    // -------------------------
    doc.setFontSize(14);
    doc.text("Scan Result", 20, 90);

    doc.setFontSize(12);
    doc.text(`Result: ${data.result}`, 20, 100);
    doc.text(`Model Accuracy: ${data.accuracy}%`, 20, 108);
    doc.text(`Prediction Confidence: ${data.confidence}%`, 20, 116);

    // -------------------------
    // Image Details
    // -------------------------
    doc.setFontSize(14);
    doc.text("Image Details", 20, 135);

    doc.setFontSize(12);
    doc.text(`Filename: ${data.file_info.file_name}`, 20, 145);
    doc.text(`Width: ${data.image_data.width}`, 20, 153);
    doc.text(`Height: ${data.image_data.height}`, 20, 161);
    doc.text(`Content Type: ${data.file_info.file_type}`, 20, 169);

    // -------------------------
    // Model Information
    // -------------------------
    doc.setFontSize(14);
    doc.text("Model Information", 20, 188);

    doc.setFontSize(12);
    doc.text(`Model: ${data.model_info.model_name}`, 20, 198);
    doc.text(`Version: ${data.model_info.version || "N/A"}`, 20, 206);
    doc.text(`Output Classes: ${data.model_info.output_classes || 2}`, 20, 214);

    // -------------------------
    // Images
    // -------------------------
    try {
      if (data.original_image) {
        doc.addImage(data.original_image, "JPEG", 20, 225, 75, 55);
      }

      if (data.ela_image) {
        doc.addImage(data.ela_image, "JPEG", 115, 225, 75, 55);
      }
    } catch (error) {
      console.error("Image loading error:", error);
    }

    // -------------------------
    // Footer
    // -------------------------
    doc.setFontSize(9);
    doc.text(
      "Generated by Lumen AI | AI results may not be 100% accurate.",
      pageWidth / 2,
      290,
      { align: "center" }
    );

    doc.save(`lumen-report.pdf`);
  };

  return (
    <button
      onClick={generatePDF}
      className="group relative inline-flex items-center gap-3 overflow-hidden rounded-full bg-white px-10 py-2 text-black font-bold transition-all hover:text-white border-2 border-white active:scale-95 hover:scale-110"
    >
      <div className="absolute inset-0 bg-gradient-to-r from-[#00FFFF] via-[#FF00FF] to-[#FFFF00] opacity-0 transition-opacity duration-300 group-hover:opacity-100" />
      <span className="relative z-10">Download Report</span>
    </button>
  );
};

export default ReportPDFGenerator;